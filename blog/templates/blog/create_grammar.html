{% extends 'blog/base.html' %}
{% load static %}
{% block content %}
{% load custom_filters %}

<script>
    function toggleExampleForm() {
        var exampleForm = document.getElementById("example_form");
        var btnText = document.getElementById("toggle_button");

        if (exampleForm.style.display === "none") {
            exampleForm.style.display = "block";
            btnText.innerText = "Скрыть форму примера";
        } else {
            exampleForm.style.display = "none";
            btnText.innerText = "Показать форму примера";
        }
    }
</script>

<h1>Создать новую грамматику</h1>

<form method="POST" action="{% url 'create_grammar' %}">
    {% csrf_token %}

    <!-- Грамматика -->
    <h2 class="mb-3">Грамматика</h2>
    <div class="col-lg-3 col-md-8 mx-auto">
        <div class="mb-3">
            <label for="id_level" class="form-label">Уровень</label>
            <select name="level" id="id_level" class="form-select">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
            {% if grammar_form.level.errors %}
                <div class="text-danger">
                    {% for error in grammar_form.level.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Поле автора -->
        <div class="mb-3">
            <label for="id_author" class="form-label">Автор</label>
            {{ grammar_form.author }}
            {% if grammar_form.author.errors %}
                <div class="text-danger">
                    {% for error in grammar_form.author.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Остальные поля -->
        {% for field in grammar_form %}
            {% if field.name != "level" and field.name != "author" %}
                <div class="mb-3">
                    <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                    <textarea class="form-control" id="{{ field.id_for_label }}" name="{{ field.name }}" rows="3">{{ field.value|default:'' }}</textarea>
                    {% if field.errors %}
                        <div class="text-danger">
                            {% for error in field.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}

        <!-- Кнопка для отображения/скрытия формы примера -->
        <button type="button" id="toggle_button" class="btn btn-secondary mb-3" onclick="toggleExampleForm()">Показать форму примера</button>

        <!-- Форма для добавления примера (по умолчанию скрыта) -->
        <div id="example_form" style="display:none;">
            {% for field in example_form %}
                {% if field.name != "grammar" %}
                    <div class="mb-3">
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                        <textarea class="form-control" id="{{ field.id_for_label }}" name="{{ field.name }}" rows="3">{{ field.value|default:'' }}</textarea>
                        {% if field.errors %}
                            <div class="text-danger">
                                {% for error in field.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <!-- Кнопка отправки формы -->
        <button type="submit" class="btn btn-primary">Сохранить грамматику</button>
    </div>
</form>

{% endblock %}